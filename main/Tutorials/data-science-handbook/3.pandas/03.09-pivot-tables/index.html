<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academia 4.3.1">
  <meta name="generator" content="Hugo 0.59.1" />

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Little Dragon">

  
  
  
    
  
  <meta name="description" content="We have seen how the GroupBy abstraction lets us explore relationships within a dataset. A pivot table is a similar operation that is commonly seen in spreadsheets and other programs that operate on tabular data. The pivot table takes simple column-wise data as input, and groups the entries into a two-dimensional table that provides a multidimensional summarization of the data. The difference between pivot tables and GroupBy can sometimes cause confusion; it helps me to think of pivot tables as essentially a multidimensional version of GroupBy aggregation.">

  
  <link rel="alternate" hreflang="en-us" href="https://dragon-library.github.io/docs/library/tutorials/data-science-handbook/3.pandas/03.09-pivot-tables/">

  


  

  
  
  
  <meta name="theme-color" content="#c7254e">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kanit:400,700|Sarabun|Roboto&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/docs/library/css/academia.min.ff05a21b53038f9dccb7f30aedbfb6d7.css">

  

  
  
  

  

  <link rel="manifest" href="/docs/library/site.webmanifest">
  <link rel="icon" type="image/png" href="/docs/library/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/docs/library/img/icon-192.png">

  <link rel="canonical" href="https://dragon-library.github.io/docs/library/tutorials/data-science-handbook/3.pandas/03.09-pivot-tables/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Library">
  <meta property="og:url" content="https://dragon-library.github.io/docs/library/tutorials/data-science-handbook/3.pandas/03.09-pivot-tables/">
  <meta property="og:title" content="Pivot Tables | Library">
  <meta property="og:description" content="We have seen how the GroupBy abstraction lets us explore relationships within a dataset. A pivot table is a similar operation that is commonly seen in spreadsheets and other programs that operate on tabular data. The pivot table takes simple column-wise data as input, and groups the entries into a two-dimensional table that provides a multidimensional summarization of the data. The difference between pivot tables and GroupBy can sometimes cause confusion; it helps me to think of pivot tables as essentially a multidimensional version of GroupBy aggregation."><meta property="og:image" content="https://dragon-library.github.io/docs/library/img/icon-192.png">
  <meta property="twitter:image" content="https://dragon-library.github.io/docs/library/img/icon-192.png"><meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2020-06-18T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2020-06-18T00:00:00&#43;00:00">
  

  


  





  <title>Pivot Tables | Library</title>

</head>


<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/docs/library/">Library</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation"><span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/docs/library/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/docs/library/python/"><span>Python</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/docs/library/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/docs/library/tutorials/"><span>Tutorials</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/docs/library/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/docs/library/book/"><span>Book</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/docs/library/courses/"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/docs/library/#contact"><span>Contact</span></a>
        </li>

        
        

      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" id="search-query" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/docs/library/tutorials/data-science-handbook/intro/_index/">DS Handbook</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/intro/00.00-preface/">Preface</a>
      </li>
      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/docs/library/tutorials/data-science-handbook/1.ipython/main/">1. IPython</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/1.ipython/main/">Beyond Normal</a>
      </li>
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/1.ipython/01.01-help-and-documentation/">Help and Documentation</a>
      </li>
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/1.ipython/01.02-shell-keyboard-shortcuts/">Keyboard Shortcuts</a>
      </li>
      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/docs/library/tutorials/data-science-handbook/3.pandas/intro/">3. Pandas</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/3.pandas/intro/">Introducing</a>
      </li>
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/3.pandas/03.02-data-indexing-and-selection/">Data Indexing and Selection</a>
      </li>
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/3.pandas/03.03-operations-in-pandas/">Operating on Data</a>
      </li>
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/3.pandas/03.04-missing-values/">Handling Missing Data</a>
      </li>
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/3.pandas/03.05-hierarchical-indexing/">Hierarchical Indexing</a>
      </li>
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/3.pandas/03.06-concat-and-append/">Concat and Append</a>
      </li>
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/3.pandas/03.07-merge-and-join/">Merge and Join</a>
      </li>
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/3.pandas/03.08-aggregation-and-grouping/">Grouping</a>
      </li>
      
      <li class="active">
        <a href="/docs/library/tutorials/data-science-handbook/3.pandas/03.09-pivot-tables/">Pivot Tables</a>
      </li>
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/3.pandas/03.10-working-with-strings/">String Operations</a>
      </li>
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/3.pandas/03.11-working-with-time-series/03.11-working-with-time-series/">Time Series</a>
      </li>
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/3.pandas/03.12-performance-eval-and-query/">eval() and query()</a>
      </li>
      
      <li >
        <a href="/docs/library/tutorials/data-science-handbook/3.pandas/03.13-further-resources/">Further Resources</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#motivating-pivot-tables">Motivating Pivot Tables</a></li>
<li><a href="#pivot-tables-by-hand">Pivot Tables by Hand</a></li>
<li><a href="#pivot-table-syntax">Pivot Table Syntax</a>
<ul>
<li><a href="#multi-level-pivot-tables">Multi-level pivot tables</a></li>
<li><a href="#additional-pivot-table-options">Additional pivot table options</a></li>
</ul></li>
<li><a href="#example-birthrate-data">Example: Birthrate Data</a>
<ul>
<li><a href="#further-data-exploration">Further data exploration</a></li>
</ul></li>
</ul></li>
</ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article" itemscope itemtype="http://schema.org/Article">

        <div class="docs-article-container">
          <h1 itemprop="name">Pivot Tables</h1>

          <div class="article-style" itemprop="articleBody">
            

<p>We have seen how the <code>GroupBy</code> abstraction lets us explore relationships within a dataset.
A <em>pivot table</em> is a similar operation that is commonly seen in spreadsheets and other programs that operate on tabular data.
The pivot table takes simple column-wise data as input, and groups the entries into a two-dimensional table that provides a multidimensional summarization of the data.
The difference between pivot tables and <code>GroupBy</code> can sometimes cause confusion; it helps me to think of pivot tables as essentially a <em>multidimensional</em> version of <code>GroupBy</code> aggregation.
That is, you split-apply-combine, but both the split and the combine happen across not a one-dimensional index, but across a two-dimensional grid.</p>

<h2 id="motivating-pivot-tables">Motivating Pivot Tables</h2>

<p>For the examples in this section, we&rsquo;ll use the database of passengers on the <em>Titanic</em>, available through the Seaborn library (see <a href="04.14-Visualization-With-Seaborn.ipynb" target="_blank">Visualization With Seaborn</a>):</p>

<pre><code class="language-python">import numpy as np
import pandas as pd
import seaborn as sns
titanic = sns.load_dataset('titanic')
</code></pre>

<pre><code class="language-python">titanic.head()
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>survived</th>
      <th>pclass</th>
      <th>sex</th>
      <th>age</th>
      <th>sibsp</th>
      <th>parch</th>
      <th>fare</th>
      <th>embarked</th>
      <th>class</th>
      <th>who</th>
      <th>adult_male</th>
      <th>deck</th>
      <th>embark_town</th>
      <th>alive</th>
      <th>alone</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>3</td>
      <td>male</td>
      <td>22.0</td>
      <td>1</td>
      <td>0</td>
      <td>7.2500</td>
      <td>S</td>
      <td>Third</td>
      <td>man</td>
      <td>True</td>
      <td>NaN</td>
      <td>Southampton</td>
      <td>no</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>female</td>
      <td>38.0</td>
      <td>1</td>
      <td>0</td>
      <td>71.2833</td>
      <td>C</td>
      <td>First</td>
      <td>woman</td>
      <td>False</td>
      <td>C</td>
      <td>Cherbourg</td>
      <td>yes</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>3</td>
      <td>female</td>
      <td>26.0</td>
      <td>0</td>
      <td>0</td>
      <td>7.9250</td>
      <td>S</td>
      <td>Third</td>
      <td>woman</td>
      <td>False</td>
      <td>NaN</td>
      <td>Southampton</td>
      <td>yes</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
      <td>female</td>
      <td>35.0</td>
      <td>1</td>
      <td>0</td>
      <td>53.1000</td>
      <td>S</td>
      <td>First</td>
      <td>woman</td>
      <td>False</td>
      <td>C</td>
      <td>Southampton</td>
      <td>yes</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>3</td>
      <td>male</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>8.0500</td>
      <td>S</td>
      <td>Third</td>
      <td>man</td>
      <td>True</td>
      <td>NaN</td>
      <td>Southampton</td>
      <td>no</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>

<p>This contains a wealth of information on each passenger of that ill-fated voyage, including gender, age, class, fare paid, and much more.</p>

<h2 id="pivot-tables-by-hand">Pivot Tables by Hand</h2>

<p>To start learning more about this data, we might begin by grouping according to gender, survival status, or some combination thereof.
If you have read the previous section, you might be tempted to apply a <code>GroupBy</code> operation–for example, let&rsquo;s look at survival rate by gender:</p>

<pre><code class="language-python">titanic.groupby('sex')[['survived']].mean()
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>survived</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>female</th>
      <td>0.742038</td>
    </tr>
    <tr>
      <th>male</th>
      <td>0.188908</td>
    </tr>
  </tbody>
</table>
</div>

<p>This immediately gives us some insight: overall, three of every four females on board survived, while only one in five males survived!</p>

<p>This is useful, but we might like to go one step deeper and look at survival by both sex and, say, class.
Using the vocabulary of <code>GroupBy</code>, we might proceed using something like this:
we <em>group by</em> class and gender, <em>select</em> survival, <em>apply</em> a mean aggregate, <em>combine</em> the resulting groups, and then <em>unstack</em> the hierarchical index to reveal the hidden multidimensionality. In code:</p>

<pre><code class="language-python">titanic.groupby(['sex', 'class'])['survived'].aggregate('mean').unstack()
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>class</th>
      <th>First</th>
      <th>Second</th>
      <th>Third</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>female</th>
      <td>0.968085</td>
      <td>0.921053</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>male</th>
      <td>0.368852</td>
      <td>0.157407</td>
      <td>0.135447</td>
    </tr>
  </tbody>
</table>
</div>

<p>This gives us a better idea of how both gender and class affected survival, but the code is starting to look a bit garbled.
While each step of this pipeline makes sense in light of the tools we&rsquo;ve previously discussed, the long string of code is not particularly easy to read or use.
This two-dimensional <code>GroupBy</code> is common enough that Pandas includes a convenience routine, <code>pivot_table</code>, which succinctly handles this type of multi-dimensional aggregation.</p>

<h2 id="pivot-table-syntax">Pivot Table Syntax</h2>

<p>Here is the equivalent to the preceding operation using the <code>pivot_table</code> method of <code>DataFrame</code>s:</p>

<pre><code class="language-python">titanic.pivot_table('survived', index='sex', columns='class')
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>class</th>
      <th>First</th>
      <th>Second</th>
      <th>Third</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>female</th>
      <td>0.968085</td>
      <td>0.921053</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>male</th>
      <td>0.368852</td>
      <td>0.157407</td>
      <td>0.135447</td>
    </tr>
  </tbody>
</table>
</div>

<p>This is eminently more readable than the <code>groupby</code> approach, and produces the same result.
As you might expect of an early 20th-century transatlantic cruise, the survival gradient favors both women and higher classes.
First-class women survived with near certainty (hi, Rose!), while only one in ten third-class men survived (sorry, Jack!).</p>

<h3 id="multi-level-pivot-tables">Multi-level pivot tables</h3>

<p>Just as in the <code>GroupBy</code>, the grouping in pivot tables can be specified with multiple levels, and via a number of options.
For example, we might be interested in looking at age as a third dimension.
We&rsquo;ll bin the age using the <code>pd.cut</code> function:</p>

<pre><code class="language-python">age = pd.cut(titanic['age'], [0, 18, 80])
titanic.pivot_table('survived', ['sex', age], 'class')
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>class</th>
      <th>First</th>
      <th>Second</th>
      <th>Third</th>
    </tr>
    <tr>
      <th>sex</th>
      <th>age</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">female</th>
      <th>(0, 18]</th>
      <td>0.909091</td>
      <td>1.000000</td>
      <td>0.511628</td>
    </tr>
    <tr>
      <th>(18, 80]</th>
      <td>0.972973</td>
      <td>0.900000</td>
      <td>0.423729</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">male</th>
      <th>(0, 18]</th>
      <td>0.800000</td>
      <td>0.600000</td>
      <td>0.215686</td>
    </tr>
    <tr>
      <th>(18, 80]</th>
      <td>0.375000</td>
      <td>0.071429</td>
      <td>0.133663</td>
    </tr>
  </tbody>
</table>
</div>

<p>We can apply the same strategy when working with the columns as well; let&rsquo;s add info on the fare paid using <code>pd.qcut</code> to automatically compute quantiles:</p>

<pre><code class="language-python">fare = pd.qcut(titanic['fare'], 2)
titanic.pivot_table('survived', ['sex', age], [fare, 'class'])
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>fare</th>
      <th colspan="3" halign="left">[0, 14.454]</th>
      <th colspan="3" halign="left">(14.454, 512.329]</th>
    </tr>
    <tr>
      <th></th>
      <th>class</th>
      <th>First</th>
      <th>Second</th>
      <th>Third</th>
      <th>First</th>
      <th>Second</th>
      <th>Third</th>
    </tr>
    <tr>
      <th>sex</th>
      <th>age</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">female</th>
      <th>(0, 18]</th>
      <td>NaN</td>
      <td>1.000000</td>
      <td>0.714286</td>
      <td>0.909091</td>
      <td>1.000000</td>
      <td>0.318182</td>
    </tr>
    <tr>
      <th>(18, 80]</th>
      <td>NaN</td>
      <td>0.880000</td>
      <td>0.444444</td>
      <td>0.972973</td>
      <td>0.914286</td>
      <td>0.391304</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">male</th>
      <th>(0, 18]</th>
      <td>NaN</td>
      <td>0.000000</td>
      <td>0.260870</td>
      <td>0.800000</td>
      <td>0.818182</td>
      <td>0.178571</td>
    </tr>
    <tr>
      <th>(18, 80]</th>
      <td>0.0</td>
      <td>0.098039</td>
      <td>0.125000</td>
      <td>0.391304</td>
      <td>0.030303</td>
      <td>0.192308</td>
    </tr>
  </tbody>
</table>
</div>

<p>The result is a four-dimensional aggregation with hierarchical indices (see <a href="03.05-Hierarchical-Indexing.ipynb" target="_blank">Hierarchical Indexing</a>), shown in a grid demonstrating the relationship between the values.</p>

<h3 id="additional-pivot-table-options">Additional pivot table options</h3>

<p>The full call signature of the <code>pivot_table</code> method of <code>DataFrame</code>s is as follows:</p>

<pre><code class="language-python"># call signature as of Pandas 0.18
DataFrame.pivot_table(data, values=None, index=None, columns=None,
                      aggfunc='mean', fill_value=None, margins=False,
                      dropna=True, margins_name='All')
</code></pre>

<p>We&rsquo;ve already seen examples of the first three arguments; here we&rsquo;ll take a quick look at the remaining ones.
Two of the options, <code>fill_value</code> and <code>dropna</code>, have to do with missing data and are fairly straightforward; we will not show examples of them here.</p>

<p>The <code>aggfunc</code> keyword controls what type of aggregation is applied, which is a mean by default.
As in the GroupBy, the aggregation specification can be a string representing one of several common choices (e.g., <code>'sum'</code>, <code>'mean'</code>, <code>'count'</code>, <code>'min'</code>, <code>'max'</code>, etc.) or a function that implements an aggregation (e.g., <code>np.sum()</code>, <code>min()</code>, <code>sum()</code>, etc.).
Additionally, it can be specified as a dictionary mapping a column to any of the above desired options:</p>

<pre><code class="language-python">titanic.pivot_table(index='sex', columns='class',
                    aggfunc={'survived':sum, 'fare':'mean'})
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">fare</th>
      <th colspan="3" halign="left">survived</th>
    </tr>
    <tr>
      <th>class</th>
      <th>First</th>
      <th>Second</th>
      <th>Third</th>
      <th>First</th>
      <th>Second</th>
      <th>Third</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>female</th>
      <td>106.125798</td>
      <td>21.970121</td>
      <td>16.118810</td>
      <td>91.0</td>
      <td>70.0</td>
      <td>72.0</td>
    </tr>
    <tr>
      <th>male</th>
      <td>67.226127</td>
      <td>19.741782</td>
      <td>12.661633</td>
      <td>45.0</td>
      <td>17.0</td>
      <td>47.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Notice also here that we&rsquo;ve omitted the <code>values</code> keyword; when specifying a mapping for <code>aggfunc</code>, this is determined automatically.</p>

<p>At times it&rsquo;s useful to compute totals along each grouping.
This can be done via the <code>margins</code> keyword:</p>

<pre><code class="language-python">titanic.pivot_table('survived', index='sex', columns='class', margins=True)
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>class</th>
      <th>First</th>
      <th>Second</th>
      <th>Third</th>
      <th>All</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>female</th>
      <td>0.968085</td>
      <td>0.921053</td>
      <td>0.500000</td>
      <td>0.742038</td>
    </tr>
    <tr>
      <th>male</th>
      <td>0.368852</td>
      <td>0.157407</td>
      <td>0.135447</td>
      <td>0.188908</td>
    </tr>
    <tr>
      <th>All</th>
      <td>0.629630</td>
      <td>0.472826</td>
      <td>0.242363</td>
      <td>0.383838</td>
    </tr>
  </tbody>
</table>
</div>

<p>Here this automatically gives us information about the class-agnostic survival rate by gender, the gender-agnostic survival rate by class, and the overall survival rate of 38%.
The margin label can be specified with the <code>margins_name</code> keyword, which defaults to <code>&quot;All&quot;</code>.</p>

<h2 id="example-birthrate-data">Example: Birthrate Data</h2>

<p>As a more interesting example, let&rsquo;s take a look at the freely available data on births in the United States, provided by the Centers for Disease Control (CDC).
This data can be found at <a href="https://raw.githubusercontent.com/jakevdp/data-CDCbirths/master/births.csv" target="_blank">https://raw.githubusercontent.com/jakevdp/data-CDCbirths/master/births.csv</a>
(this dataset has been analyzed rather extensively by Andrew Gelman and his group; see, for example, <a href="http://andrewgelman.com/2012/06/14/cool-ass-signal-processing-using-gaussian-processes/" target="_blank">this blog post</a>):</p>

<pre><code class="language-python"># shell command to download the data:
# !curl -O https://raw.githubusercontent.com/jakevdp/data-CDCbirths/master/births.csv
</code></pre>

<pre><code class="language-python">births = pd.read_csv('data/births.csv')
</code></pre>

<p>Taking a look at the data, we see that it&rsquo;s relatively simple–it contains the number of births grouped by date and gender:</p>

<pre><code class="language-python">births.head()
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>month</th>
      <th>day</th>
      <th>gender</th>
      <th>births</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1969</td>
      <td>1</td>
      <td>1</td>
      <td>F</td>
      <td>4046</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1969</td>
      <td>1</td>
      <td>1</td>
      <td>M</td>
      <td>4440</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1969</td>
      <td>1</td>
      <td>2</td>
      <td>F</td>
      <td>4454</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1969</td>
      <td>1</td>
      <td>2</td>
      <td>M</td>
      <td>4548</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1969</td>
      <td>1</td>
      <td>3</td>
      <td>F</td>
      <td>4548</td>
    </tr>
  </tbody>
</table>
</div>

<p>We can start to understand this data a bit more by using a pivot table.
Let&rsquo;s add a decade column, and take a look at male and female births as a function of decade:</p>

<pre><code class="language-python">births['decade'] = 10 * (births['year'] // 10)
births.pivot_table('births', index='decade', columns='gender', aggfunc='sum')
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>gender</th>
      <th>F</th>
      <th>M</th>
    </tr>
    <tr>
      <th>decade</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1960</th>
      <td>1753634</td>
      <td>1846572</td>
    </tr>
    <tr>
      <th>1970</th>
      <td>16263075</td>
      <td>17121550</td>
    </tr>
    <tr>
      <th>1980</th>
      <td>18310351</td>
      <td>19243452</td>
    </tr>
    <tr>
      <th>1990</th>
      <td>19479454</td>
      <td>20420553</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>18229309</td>
      <td>19106428</td>
    </tr>
  </tbody>
</table>
</div>

<p>We immediately see that male births outnumber female births in every decade.
To see this trend a bit more clearly, we can use the built-in plotting tools in Pandas to visualize the total number of births by year (see <a href="04.00-Introduction-To-Matplotlib.ipynb" target="_blank">Introduction to Matplotlib</a> for a discussion of plotting with Matplotlib):</p>

<pre><code class="language-python">%matplotlib inline
import matplotlib.pyplot as plt
sns.set()  # use Seaborn styles
births.pivot_table('births', index='year', columns='gender', aggfunc='sum').plot()
plt.ylabel('total births per year');
</code></pre>

<p><img src="../img/output_35_0.png" alt="" /></p>

<p>With a simple pivot table and <code>plot()</code> method, we can immediately see the annual trend in births by gender. By eye, it appears that over the past 50 years male births have outnumbered female births by around 5%.</p>

<h3 id="further-data-exploration">Further data exploration</h3>

<p>Though this doesn&rsquo;t necessarily relate to the pivot table, there are a few more interesting features we can pull out of this dataset using the Pandas tools covered up to this point.
We must start by cleaning the data a bit, removing outliers caused by mistyped dates (e.g., June 31st) or missing values (e.g., June 99th).
One easy way to remove these all at once is to cut outliers; we&rsquo;ll do this via a robust sigma-clipping operation:</p>

<pre><code class="language-python">quartiles = np.percentile(births['births'], [25, 50, 75])
mu = quartiles[1]
sig = 0.74 * (quartiles[2] - quartiles[0])
</code></pre>

<p>This final line is a robust estimate of the sample mean, where the 0.74 comes from the interquartile range of a Gaussian distribution (You can learn more about sigma-clipping operations in a book I coauthored with Željko Ivezić, Andrew J. Connolly, and Alexander Gray: <a href="http://press.princeton.edu/titles/10159.html" target="_blank">&laquo;Statistics, Data Mining, and Machine Learning in Astronomy&raquo;</a> (Princeton University Press, 2014)).</p>

<p>With this we can use the <code>query()</code> method (discussed further in <a href="03.12-Performance-Eval-and-Query.ipynb" target="_blank">High-Performance Pandas: <code>eval()</code> and <code>query()</code></a>) to filter-out rows with births outside these values:</p>

<pre><code class="language-python">births = births.query('(births &gt; @mu - 5 * @sig) &amp; (births &lt; @mu + 5 * @sig)')
</code></pre>

<p>Next we set the <code>day</code> column to integers; previously it had been a string because some columns in the dataset contained the value <code>'null'</code>:</p>

<pre><code class="language-python"># set 'day' column to integer; it originally was a string due to nulls
births['day'] = births['day'].astype(int)
</code></pre>

<p>Finally, we can combine the day, month, and year to create a Date index (see <a href="03.11-Working-with-Time-Series.ipynb" target="_blank">Working with Time Series</a>).
This allows us to quickly compute the weekday corresponding to each row:</p>

<pre><code class="language-python"># create a datetime index from the year, month, day
births.index = pd.to_datetime(10000 * births.year +
                              100 * births.month +
                              births.day, format='%Y%m%d')

births['dayofweek'] = births.index.dayofweek
</code></pre>

<p>Using this we can plot births by weekday for several decades:</p>

<pre><code class="language-python">import matplotlib.pyplot as plt
import matplotlib as mpl

births.pivot_table('births', index='dayofweek',
                    columns='decade', aggfunc='mean').plot()
plt.gca().set_xticklabels(['Mon', 'Tues', 'Wed', 'Thurs', 'Fri', 'Sat', 'Sun'])
plt.ylabel('mean births by day');
</code></pre>

<p><img src="./img/output_46_0.png" alt="" /></p>

<p>Apparently births are slightly less common on weekends than on weekdays! Note that the 1990s and 2000s are missing because the CDC data contains only the month of birth starting in 1989.</p>

<p>Another intersting view is to plot the mean number of births by the day of the <em>year</em>.
Let&rsquo;s first group the data by month and day separately:</p>

<pre><code class="language-python">births_by_date = births.pivot_table('births', 
                                    [births.index.month, births.index.day])
births_by_date.head()
</code></pre>

<pre><code>   1    4009.225
   2    4247.400
   3    4500.900
   4    4571.350
   5    4603.625
Name: births, dtype: float64
</code></pre>

<p>The result is a multi-index over months and days.
To make this easily plottable, let&rsquo;s turn these months and days into a date by associating them with a dummy year variable (making sure to choose a leap year so February 29th is correctly handled!)</p>

<pre><code class="language-python">births_by_date.index = [pd.datetime(2012, month, day)
                        for (month, day) in births_by_date.index]
births_by_date.head()
</code></pre>

<pre><code>2012-01-01    4009.225
2012-01-02    4247.400
2012-01-03    4500.900
2012-01-04    4571.350
2012-01-05    4603.625
Name: births, dtype: float64
</code></pre>

<p>Focusing on the month and day only, we now have a time series reflecting the average number of births by date of the year.
From this, we can use the <code>plot</code> method to plot the data. It reveals some interesting trends:</p>

<pre><code class="language-python"># Plot the results
fig, ax = plt.subplots(figsize=(12, 4))
births_by_date.plot(ax=ax);
</code></pre>

<p><img src="../output_52_0.png" alt="png" /></p>

<p>In particular, the striking feature of this graph is the dip in birthrate on US holidays (e.g., Independence Day, Labor Day, Thanksgiving, Christmas, New Year&rsquo;s Day) although this likely reflects trends in scheduled/induced births rather than some deep psychosomatic effect on natural births.
For more discussion on this trend, see the analysis and links in <a href="http://andrewgelman.com/2012/06/14/cool-ass-signal-processing-using-gaussian-processes/" target="_blank">Andrew Gelman&rsquo;s blog post</a> on the subject.
We&rsquo;ll return to this figure in <a href="04.09-Text-and-Annotation.ipynb#Example:-Effect-of-Holidays-on-US-Births" target="_blank">Example:-Effect-of-Holidays-on-US-Births</a>, where we will use Matplotlib&rsquo;s tools to annotate this plot.</p>

<p>Looking at this short example, you can see that many of the Python and Pandas tools we&rsquo;ve seen to this point can be combined and used to gain insight from a variety of datasets.
We will see some more sophisticated applications of these data manipulations in future sections!</p>

          </div>

          



          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item box ">
    <div class="meta-nav meta-prev">Previous <br>
    <a href="/docs/library/tutorials/data-science-handbook/3.pandas/03.08-aggregation-and-grouping/" rel="next">Grouping</a></div>
  </div>
  
  
  
  <div class="post-nav-item box">
    <div class="meta-nav meta-next" >Next <br>
    <a href="/docs/library/tutorials/data-science-handbook/3.pandas/03.10-working-with-strings/" rel="prev">String Operations</a></div>
  </div>
  
  <br>
  <br>
</div>

          </div>
          
        </div>

        <div class="body-footer">
          Last updated on Jun 18, 2020
        </div>

      </article>

      <footer class="site-footer">

  <div class="container">
    <div class="row">
      <div class="col-md-6">
        
        <p>
          
          Powered by
          <a href="https://themefisher.com" target="_blank" rel="noopener">themefisher</a> for
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.
        </p>
      </div>
      <div class="col-md-6">
        <ul class="list-inline network-icon text-right">
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://twitter.com/Twitter" target="_blank" rel="noopener" title="DM Me"><i class="fab fa-twitter" aria-hidden="true"></i></a>
          </li>
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="skype:echo123?call"  title="Skype Me"><i class="fab fa-skype" aria-hidden="true"></i></a>
          </li>
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://keybase.io/" target="_blank" rel="noopener" title="Chat on Keybase"><i class="fab fa-keybase" aria-hidden="true"></i></a>
          </li>
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://discourse.gohugo.io" target="_blank" rel="noopener" title="Discuss on Forum"><i class="fas fa-comments" aria-hidden="true"></i></a>
          </li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>

    </main>
  </div>
</div>


      

    
    
    
    <script src="/docs/library/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/python.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/docs/library/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/docs/library/js/academia.min.e4fc229c2f28284fc2dfa5b66a52b765.js"></script>

    






  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
