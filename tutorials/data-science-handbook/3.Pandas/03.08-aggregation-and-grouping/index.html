<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academia 4.3.1">
  <meta name="generator" content="Hugo 0.59.1" />

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Little Dragon">

  
  
  
    
  
  <meta name="description" content="An essential piece of analysis of large data is efficient summarization: computing aggregations like sum(), mean(), median(), min(), and max(), in which a single number gives insight into the nature of a potentially large dataset. In this section, we&rsquo;ll explore aggregations in Pandas, from simple operations akin to what we&rsquo;ve seen on NumPy arrays, to more sophisticated operations based on the concept of a groupby.
For convenience, we&rsquo;ll use the same display magic function that we&rsquo;ve seen in previous sections:">

  
  <link rel="alternate" hreflang="en-us" href="https://dragon-library.github.io/tutorials/data-science-handbook/3.pandas/03.08-aggregation-and-grouping/">

  


  

  
  
  
  <meta name="theme-color" content="#c7254e">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kanit:400,700|Sarabun|Roboto&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academia.min.ff05a21b53038f9dccb7f30aedbfb6d7.css">

  

  
  
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://dragon-library.github.io/tutorials/data-science-handbook/3.pandas/03.08-aggregation-and-grouping/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Library">
  <meta property="og:url" content="https://dragon-library.github.io/tutorials/data-science-handbook/3.pandas/03.08-aggregation-and-grouping/">
  <meta property="og:title" content="Aggregation and Grouping | Library">
  <meta property="og:description" content="An essential piece of analysis of large data is efficient summarization: computing aggregations like sum(), mean(), median(), min(), and max(), in which a single number gives insight into the nature of a potentially large dataset. In this section, we&rsquo;ll explore aggregations in Pandas, from simple operations akin to what we&rsquo;ve seen on NumPy arrays, to more sophisticated operations based on the concept of a groupby.
For convenience, we&rsquo;ll use the same display magic function that we&rsquo;ve seen in previous sections:"><meta property="og:image" content="https://dragon-library.github.io/img/icon-192.png">
  <meta property="twitter:image" content="https://dragon-library.github.io/img/icon-192.png"><meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2020-06-18T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2020-06-19T01:41:59&#43;07:00">
  

  


  





  <title>Aggregation and Grouping | Library</title>

</head>


<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Library</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation"><span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/python/"><span>Python</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/tutorials/"><span>Tutorials</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/book/"><span>Book</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/courses/"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" id="search-query" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/tutorials/data-science-handbook/intro/_index/">DS Handbook</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/tutorials/data-science-handbook/intro/00.00-preface/">Preface</a>
      </li>
      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/tutorials/data-science-handbook/1.ipython/main/">1. IPython</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/tutorials/data-science-handbook/1.ipython/main/">Beyond Normal</a>
      </li>
      
      <li >
        <a href="/tutorials/data-science-handbook/1.ipython/01.01-help-and-documentation/">Help and Documentation</a>
      </li>
      
      <li >
        <a href="/tutorials/data-science-handbook/1.ipython/01.02-shell-keyboard-shortcuts/">Keyboard Shortcuts</a>
      </li>
      
    </ul>
    

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/tutorials/data-science-handbook/3.pandas/intro/">3. Pandas</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/tutorials/data-science-handbook/3.pandas/intro/">Introducing</a>
      </li>
      
      <li >
        <a href="/tutorials/data-science-handbook/3.pandas/03.02-data-indexing-and-selection/">Data Indexing and Selection</a>
      </li>
      
      <li >
        <a href="/tutorials/data-science-handbook/3.pandas/03.03-operations-in-pandas/">Operating on Data</a>
      </li>
      
      <li >
        <a href="/tutorials/data-science-handbook/3.pandas/03.04-missing-values/">Handling Missing Data</a>
      </li>
      
      <li >
        <a href="/tutorials/data-science-handbook/3.pandas/03.05-hierarchical-indexing/">Hierarchical Indexing</a>
      </li>
      
      <li >
        <a href="/tutorials/data-science-handbook/3.pandas/03.06-concat-and-append/">Concat and Append</a>
      </li>
      
      <li >
        <a href="/tutorials/data-science-handbook/3.pandas/03.07-merge-and-join/">Merge and Join</a>
      </li>
      
      <li class="active">
        <a href="/tutorials/data-science-handbook/3.pandas/03.08-aggregation-and-grouping/">Grouping</a>
      </li>
      
      <li >
        <a href="/tutorials/data-science-handbook/3.pandas/03.09-pivot-tables/">Pivot Tables</a>
      </li>
      
      <li >
        <a href="/tutorials/data-science-handbook/3.pandas/03.10-working-with-strings/">String Operations</a>
      </li>
      
      <li >
        <a href="/tutorials/data-science-handbook/3.pandas/03.11-working-with-time-series/03.11-working-with-time-series/">Time Series</a>
      </li>
      
      <li >
        <a href="/tutorials/data-science-handbook/3.pandas/03.12-performance-eval-and-query/">eval() and query()</a>
      </li>
      
      <li >
        <a href="/tutorials/data-science-handbook/3.pandas/03.13-further-resources/">Further Resources</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#planets-data">Planets Data</a></li>
<li><a href="#simple-aggregation-in-pandas">Simple Aggregation in Pandas</a></li>
<li><a href="#groupby-split-apply-combine">GroupBy: Split, Apply, Combine</a>
<ul>
<li><a href="#split-apply-combine">Split, apply, combine</a></li>
<li><a href="#the-groupby-object">The GroupBy object</a>
<ul>
<li><a href="#column-indexing">Column indexing</a></li>
<li><a href="#iteration-over-groups">Iteration over groups</a></li>
<li><a href="#dispatch-methods">Dispatch methods</a></li>
</ul></li>
<li><a href="#aggregate-filter-transform-apply">Aggregate, filter, transform, apply</a>
<ul>
<li><a href="#aggregation">Aggregation</a></li>
<li><a href="#filtering">Filtering</a></li>
<li><a href="#transformation">Transformation</a></li>
<li><a href="#the-apply-method">The apply() method</a></li>
</ul></li>
<li><a href="#specifying-the-split-key">Specifying the split key</a>
<ul>
<li><a href="#a-list-array-series-or-index-providing-the-grouping-keys">A list, array, series, or index providing the grouping keys</a></li>
<li><a href="#a-dictionary-or-series-mapping-index-to-group">A dictionary or series mapping index to group</a></li>
<li><a href="#any-python-function">Any Python function</a></li>
<li><a href="#a-list-of-valid-keys">A list of valid keys</a></li>
</ul></li>
<li><a href="#grouping-example">Grouping example</a></li>
</ul></li>
</ul></li>
</ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article" itemscope itemtype="http://schema.org/Article">

        <div class="docs-article-container">
          <h1 itemprop="name">Aggregation and Grouping</h1>

          <div class="article-style" itemprop="articleBody">
            

<p>An essential piece of analysis of large data is efficient summarization: computing aggregations like <code>sum()</code>, <code>mean()</code>, <code>median()</code>, <code>min()</code>, and <code>max()</code>, in which a single number gives insight into the nature of a potentially large dataset.
In this section, we&rsquo;ll explore aggregations in Pandas, from simple operations akin to what we&rsquo;ve seen on NumPy arrays, to more sophisticated operations based on the concept of a <code>groupby</code>.</p>

<p>For convenience, we&rsquo;ll use the same <code>display</code> magic function that we&rsquo;ve seen in previous sections:</p>

<pre><code class="language-python">import numpy as np
import pandas as pd

class display(object):
    &quot;&quot;&quot;Display HTML representation of multiple objects&quot;&quot;&quot;
    template = &quot;&quot;&quot;&lt;div style=&quot;float: left; padding: 10px;&quot;&gt;
    &lt;p style='font-family:&quot;Courier New&quot;, Courier, monospace'&gt;{0}&lt;/p&gt;{1}
    &lt;/div&gt;&quot;&quot;&quot;
    def __init__(self, *args):
        self.args = args
        
    def _repr_html_(self):
        return '\n'.join(self.template.format(a, eval(a)._repr_html_())
                         for a in self.args)
    
    def __repr__(self):
        return '\n\n'.join(a + '\n' + repr(eval(a))
                           for a in self.args)
</code></pre>

<h2 id="planets-data">Planets Data</h2>

<p>Here we will use the Planets dataset, available via the <a href="http://seaborn.pydata.org/" target="_blank">Seaborn package</a> (see <a href="04.14-Visualization-With-Seaborn.ipynb" target="_blank">Visualization With Seaborn</a>).
It gives information on planets that astronomers have discovered around other stars (known as <em>extrasolar planets</em> or <em>exoplanets</em> for short). It can be downloaded with a simple Seaborn command:</p>

<pre><code class="language-python">import seaborn as sns
planets = sns.load_dataset('planets')
planets.shape
</code></pre>

<pre><code>(1035, 6)
</code></pre>

<pre><code class="language-python">planets.head()
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>method</th>
      <th>number</th>
      <th>orbital_period</th>
      <th>mass</th>
      <th>distance</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Radial Velocity</td>
      <td>1</td>
      <td>269.300</td>
      <td>7.10</td>
      <td>77.40</td>
      <td>2006</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Radial Velocity</td>
      <td>1</td>
      <td>874.774</td>
      <td>2.21</td>
      <td>56.95</td>
      <td>2008</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Radial Velocity</td>
      <td>1</td>
      <td>763.000</td>
      <td>2.60</td>
      <td>19.84</td>
      <td>2011</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Radial Velocity</td>
      <td>1</td>
      <td>326.030</td>
      <td>19.40</td>
      <td>110.62</td>
      <td>2007</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Radial Velocity</td>
      <td>1</td>
      <td>516.220</td>
      <td>10.50</td>
      <td>119.47</td>
      <td>2009</td>
    </tr>
  </tbody>
</table>
</div>

<p>This has some details on the 1,000+ extrasolar planets discovered up to 2014.</p>

<h2 id="simple-aggregation-in-pandas">Simple Aggregation in Pandas</h2>

<p>Earlier, we explored some of the data aggregations available for NumPy arrays (<a href="02.04-Computation-on-arrays-aggregates.ipynb" target="_blank">&laquo;Aggregations: Min, Max, and Everything In Between&raquo;</a>).
As with a one-dimensional NumPy array, for a Pandas <code>Series</code> the aggregates return a single value:</p>

<pre><code class="language-python">rng = np.random.RandomState(42)
ser = pd.Series(rng.rand(5))
ser
</code></pre>

<pre><code>0    0.374540
1    0.950714
2    0.731994
3    0.598658
4    0.156019
dtype: float64
</code></pre>

<pre><code class="language-python">ser.sum()
</code></pre>

<pre><code>2.8119254917081569
</code></pre>

<pre><code class="language-python">ser.mean()
</code></pre>

<pre><code>0.56238509834163142
</code></pre>

<p>For a <code>DataFrame</code>, by default the aggregates return results within each column:</p>

<pre><code class="language-python">df = pd.DataFrame({'A': rng.rand(5),
                   'B': rng.rand(5)})
df
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.155995</td>
      <td>0.020584</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.058084</td>
      <td>0.969910</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.866176</td>
      <td>0.832443</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.601115</td>
      <td>0.212339</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.708073</td>
      <td>0.181825</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python">df.mean()
</code></pre>

<pre><code>A    0.477888
B    0.443420
dtype: float64
</code></pre>

<p>By specifying the <code>axis</code> argument, you can instead aggregate within each row:</p>

<pre><code class="language-python">df.mean(axis='columns')
</code></pre>

<pre><code>0    0.088290
1    0.513997
2    0.849309
3    0.406727
4    0.444949
dtype: float64
</code></pre>

<p>Pandas <code>Series</code> and <code>DataFrame</code>s include all of the common aggregates mentioned in <a href="02.04-Computation-on-arrays-aggregates.ipynb" target="_blank">Aggregations: Min, Max, and Everything In Between</a>; in addition, there is a convenience method <code>describe()</code> that computes several common aggregates for each column and returns the result.
Let&rsquo;s use this on the Planets data, for now dropping rows with missing values:</p>

<pre><code class="language-python">planets.dropna().describe()
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>number</th>
      <th>orbital_period</th>
      <th>mass</th>
      <th>distance</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>498.00000</td>
      <td>498.000000</td>
      <td>498.000000</td>
      <td>498.000000</td>
      <td>498.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.73494</td>
      <td>835.778671</td>
      <td>2.509320</td>
      <td>52.068213</td>
      <td>2007.377510</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.17572</td>
      <td>1469.128259</td>
      <td>3.636274</td>
      <td>46.596041</td>
      <td>4.167284</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.00000</td>
      <td>1.328300</td>
      <td>0.003600</td>
      <td>1.350000</td>
      <td>1989.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.00000</td>
      <td>38.272250</td>
      <td>0.212500</td>
      <td>24.497500</td>
      <td>2005.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.00000</td>
      <td>357.000000</td>
      <td>1.245000</td>
      <td>39.940000</td>
      <td>2009.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2.00000</td>
      <td>999.600000</td>
      <td>2.867500</td>
      <td>59.332500</td>
      <td>2011.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>6.00000</td>
      <td>17337.500000</td>
      <td>25.000000</td>
      <td>354.000000</td>
      <td>2014.000000</td>
    </tr>
  </tbody>
</table>
</div>

<p>This can be a useful way to begin understanding the overall properties of a dataset.
For example, we see in the <code>year</code> column that although exoplanets were discovered as far back as 1989, half of all known expolanets were not discovered until 2010 or after.
This is largely thanks to the <em>Kepler</em> mission, which is a space-based telescope specifically designed for finding eclipsing planets around other stars.</p>

<p>The following table summarizes some other built-in Pandas aggregations:</p>

<table>
<thead>
<tr>
<th>Aggregation</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>count()</code></td>
<td>Total number of items</td>
</tr>

<tr>
<td><code>first()</code>, <code>last()</code></td>
<td>First and last item</td>
</tr>

<tr>
<td><code>mean()</code>, <code>median()</code></td>
<td>Mean and median</td>
</tr>

<tr>
<td><code>min()</code>, <code>max()</code></td>
<td>Minimum and maximum</td>
</tr>

<tr>
<td><code>std()</code>, <code>var()</code></td>
<td>Standard deviation and variance</td>
</tr>

<tr>
<td><code>mad()</code></td>
<td>Mean absolute deviation</td>
</tr>

<tr>
<td><code>prod()</code></td>
<td>Product of all items</td>
</tr>

<tr>
<td><code>sum()</code></td>
<td>Sum of all items</td>
</tr>
</tbody>
</table>

<p>These are all methods of <code>DataFrame</code> and <code>Series</code> objects.</p>

<p>To go deeper into the data, however, simple aggregates are often not enough.
The next level of data summarization is the <code>groupby</code> operation, which allows you to quickly and efficiently compute aggregates on subsets of data.</p>

<h2 id="groupby-split-apply-combine">GroupBy: Split, Apply, Combine</h2>

<p>Simple aggregations can give you a flavor of your dataset, but often we would prefer to aggregate conditionally on some label or index: this is implemented in the so-called <code>groupby</code> operation.
The name &laquo;group by&raquo; comes from a command in the SQL database language, but it is perhaps more illuminative to think of it in the terms first coined by Hadley Wickham of Rstats fame: <em>split, apply, combine</em>.</p>

<h3 id="split-apply-combine">Split, apply, combine</h3>

<p>A canonical example of this split-apply-combine operation, where the &laquo;apply&raquo; is a summation aggregation, is illustrated in this figure:</p>

<p><img src="figures/03.08-split-apply-combine.png" alt="" />
<a href="06.00-Figure-Code.ipynb#Split-Apply-Combine" target="_blank">figure source in Appendix</a></p>

<p>This makes clear what the <code>groupby</code> accomplishes:</p>

<ul>
<li>The <em>split</em> step involves breaking up and grouping a <code>DataFrame</code> depending on the value of the specified key.</li>
<li>The <em>apply</em> step involves computing some function, usually an aggregate, transformation, or filtering, within the individual groups.</li>
<li>The <em>combine</em> step merges the results of these operations into an output array.</li>
</ul>

<p>While this could certainly be done manually using some combination of the masking, aggregation, and merging commands covered earlier, an important realization is that <em>the intermediate splits do not need to be explicitly instantiated</em>. Rather, the <code>GroupBy</code> can (often) do this in a single pass over the data, updating the sum, mean, count, min, or other aggregate for each group along the way.
The power of the <code>GroupBy</code> is that it abstracts away these steps: the user need not think about <em>how</em> the computation is done under the hood, but rather thinks about the <em>operation as a whole</em>.</p>

<p>As a concrete example, let&rsquo;s take a look at using Pandas for the computation shown in this diagram.
We&rsquo;ll start by creating the input <code>DataFrame</code>:</p>

<pre><code class="language-python">df = pd.DataFrame({'key': ['A', 'B', 'C', 'A', 'B', 'C'],
                   'data': range(6)}, columns=['key', 'data'])
df
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>data</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>C</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>

<p>The most basic split-apply-combine operation can be computed with the <code>groupby()</code> method of <code>DataFrame</code>s, passing the name of the desired key column:</p>

<pre><code class="language-python">df.groupby('key')
</code></pre>

<pre><code>&lt;pandas.core.groupby.DataFrameGroupBy object at 0x117272160&gt;
</code></pre>

<p>Notice that what is returned is not a set of <code>DataFrame</code>s, but a <code>DataFrameGroupBy</code> object.
This object is where the magic is: you can think of it as a special view of the <code>DataFrame</code>, which is poised to dig into the groups but does no actual computation until the aggregation is applied.
This &laquo;lazy evaluation&raquo; approach means that common aggregates can be implemented very efficiently in a way that is almost transparent to the user.</p>

<p>To produce a result, we can apply an aggregate to this <code>DataFrameGroupBy</code> object, which will perform the appropriate apply/combine steps to produce the desired result:</p>

<pre><code class="language-python">df.groupby('key').sum()
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>3</td>
    </tr>
    <tr>
      <th>B</th>
      <td>5</td>
    </tr>
    <tr>
      <th>C</th>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div>

<p>The <code>sum()</code> method is just one possibility here; you can apply virtually any common Pandas or NumPy aggregation function, as well as virtually any valid <code>DataFrame</code> operation, as we will see in the following discussion.</p>

<h3 id="the-groupby-object">The GroupBy object</h3>

<p>The <code>GroupBy</code> object is a very flexible abstraction.
In many ways, you can simply treat it as if it&rsquo;s a collection of <code>DataFrame</code>s, and it does the difficult things under the hood. Let&rsquo;s see some examples using the Planets data.</p>

<p>Perhaps the most important operations made available by a <code>GroupBy</code> are <em>aggregate</em>, <em>filter</em>, <em>transform</em>, and <em>apply</em>.
We&rsquo;ll discuss each of these more fully in <a href="#Aggregate,-Filter,-Transform,-Apply">&laquo;Aggregate, Filter, Transform, Apply&raquo;</a>, but before that let&rsquo;s introduce some of the other functionality that can be used with the basic <code>GroupBy</code> operation.</p>

<h4 id="column-indexing">Column indexing</h4>

<p>The <code>GroupBy</code> object supports column indexing in the same way as the <code>DataFrame</code>, and returns a modified <code>GroupBy</code> object.
For example:</p>

<pre><code class="language-python">planets.groupby('method')
</code></pre>

<pre><code>&lt;pandas.core.groupby.DataFrameGroupBy object at 0x1172727b8&gt;
</code></pre>

<pre><code class="language-python">planets.groupby('method')['orbital_period']
</code></pre>

<pre><code>&lt;pandas.core.groupby.SeriesGroupBy object at 0x117272da0&gt;
</code></pre>

<p>Here we&rsquo;ve selected a particular <code>Series</code> group from the original <code>DataFrame</code> group by reference to its column name.
As with the <code>GroupBy</code> object, no computation is done until we call some aggregate on the object:</p>

<pre><code class="language-python">planets.groupby('method')['orbital_period'].median()
</code></pre>

<pre><code>method
Astrometry                         631.180000
Eclipse Timing Variations         4343.500000
Imaging                          27500.000000
Microlensing                      3300.000000
Orbital Brightness Modulation        0.342887
Pulsar Timing                       66.541900
Pulsation Timing Variations       1170.000000
Radial Velocity                    360.200000
Transit                              5.714932
Transit Timing Variations           57.011000
Name: orbital_period, dtype: float64
</code></pre>

<p>This gives an idea of the general scale of orbital periods (in days) that each method is sensitive to.</p>

<h4 id="iteration-over-groups">Iteration over groups</h4>

<p>The <code>GroupBy</code> object supports direct iteration over the groups, returning each group as a <code>Series</code> or <code>DataFrame</code>:</p>

<pre><code class="language-python">for (method, group) in planets.groupby('method'):
    print(&quot;{0:30s} shape={1}&quot;.format(method, group.shape))
</code></pre>

<pre><code>Astrometry                     shape=(2, 6)
Eclipse Timing Variations      shape=(9, 6)
Imaging                        shape=(38, 6)
Microlensing                   shape=(23, 6)
Orbital Brightness Modulation  shape=(3, 6)
Pulsar Timing                  shape=(5, 6)
Pulsation Timing Variations    shape=(1, 6)
Radial Velocity                shape=(553, 6)
Transit                        shape=(397, 6)
Transit Timing Variations      shape=(4, 6)
</code></pre>

<p>This can be useful for doing certain things manually, though it is often much faster to use the built-in <code>apply</code> functionality, which we will discuss momentarily.</p>

<h4 id="dispatch-methods">Dispatch methods</h4>

<p>Through some Python class magic, any method not explicitly implemented by the <code>GroupBy</code> object will be passed through and called on the groups, whether they are <code>DataFrame</code> or <code>Series</code> objects.
For example, you can use the <code>describe()</code> method of <code>DataFrame</code>s to perform a set of aggregations that describe each group in the data:</p>

<pre><code class="language-python">planets.groupby('method')['year'].describe().unstack()
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>method</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Astrometry</th>
      <td>2.0</td>
      <td>2011.500000</td>
      <td>2.121320</td>
      <td>2010.0</td>
      <td>2010.75</td>
      <td>2011.5</td>
      <td>2012.25</td>
      <td>2013.0</td>
    </tr>
    <tr>
      <th>Eclipse Timing Variations</th>
      <td>9.0</td>
      <td>2010.000000</td>
      <td>1.414214</td>
      <td>2008.0</td>
      <td>2009.00</td>
      <td>2010.0</td>
      <td>2011.00</td>
      <td>2012.0</td>
    </tr>
    <tr>
      <th>Imaging</th>
      <td>38.0</td>
      <td>2009.131579</td>
      <td>2.781901</td>
      <td>2004.0</td>
      <td>2008.00</td>
      <td>2009.0</td>
      <td>2011.00</td>
      <td>2013.0</td>
    </tr>
    <tr>
      <th>Microlensing</th>
      <td>23.0</td>
      <td>2009.782609</td>
      <td>2.859697</td>
      <td>2004.0</td>
      <td>2008.00</td>
      <td>2010.0</td>
      <td>2012.00</td>
      <td>2013.0</td>
    </tr>
    <tr>
      <th>Orbital Brightness Modulation</th>
      <td>3.0</td>
      <td>2011.666667</td>
      <td>1.154701</td>
      <td>2011.0</td>
      <td>2011.00</td>
      <td>2011.0</td>
      <td>2012.00</td>
      <td>2013.0</td>
    </tr>
    <tr>
      <th>Pulsar Timing</th>
      <td>5.0</td>
      <td>1998.400000</td>
      <td>8.384510</td>
      <td>1992.0</td>
      <td>1992.00</td>
      <td>1994.0</td>
      <td>2003.00</td>
      <td>2011.0</td>
    </tr>
    <tr>
      <th>Pulsation Timing Variations</th>
      <td>1.0</td>
      <td>2007.000000</td>
      <td>NaN</td>
      <td>2007.0</td>
      <td>2007.00</td>
      <td>2007.0</td>
      <td>2007.00</td>
      <td>2007.0</td>
    </tr>
    <tr>
      <th>Radial Velocity</th>
      <td>553.0</td>
      <td>2007.518987</td>
      <td>4.249052</td>
      <td>1989.0</td>
      <td>2005.00</td>
      <td>2009.0</td>
      <td>2011.00</td>
      <td>2014.0</td>
    </tr>
    <tr>
      <th>Transit</th>
      <td>397.0</td>
      <td>2011.236776</td>
      <td>2.077867</td>
      <td>2002.0</td>
      <td>2010.00</td>
      <td>2012.0</td>
      <td>2013.00</td>
      <td>2014.0</td>
    </tr>
    <tr>
      <th>Transit Timing Variations</th>
      <td>4.0</td>
      <td>2012.500000</td>
      <td>1.290994</td>
      <td>2011.0</td>
      <td>2011.75</td>
      <td>2012.5</td>
      <td>2013.25</td>
      <td>2014.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Looking at this table helps us to better understand the data: for example, the vast majority of planets have been discovered by the Radial Velocity and Transit methods, though the latter only became common (due to new, more accurate telescopes) in the last decade.
The newest methods seem to be Transit Timing Variation and Orbital Brightness Modulation, which were not used to discover a new planet until 2011.</p>

<p>This is just one example of the utility of dispatch methods.
Notice that they are applied <em>to each individual group</em>, and the results are then combined within <code>GroupBy</code> and returned.
Again, any valid <code>DataFrame</code>/<code>Series</code> method can be used on the corresponding <code>GroupBy</code> object, which allows for some very flexible and powerful operations!</p>

<h3 id="aggregate-filter-transform-apply">Aggregate, filter, transform, apply</h3>

<p>The preceding discussion focused on aggregation for the combine operation, but there are more options available.
In particular, <code>GroupBy</code> objects have <code>aggregate()</code>, <code>filter()</code>, <code>transform()</code>, and <code>apply()</code> methods that efficiently implement a variety of useful operations before combining the grouped data.</p>

<p>For the purpose of the following subsections, we&rsquo;ll use this <code>DataFrame</code>:</p>

<pre><code class="language-python">rng = np.random.RandomState(0)
df = pd.DataFrame({'key': ['A', 'B', 'C', 'A', 'B', 'C'],
                   'data1': range(6),
                   'data2': rng.randint(0, 10, 6)},
                   columns = ['key', 'data1', 'data2'])
df
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B</td>
      <td>4</td>
      <td>7</td>
    </tr>
    <tr>
      <th>5</th>
      <td>C</td>
      <td>5</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>

<h4 id="aggregation">Aggregation</h4>

<p>We&rsquo;re now familiar with <code>GroupBy</code> aggregations with <code>sum()</code>, <code>median()</code>, and the like, but the <code>aggregate()</code> method allows for even more flexibility.
It can take a string, a function, or a list thereof, and compute all the aggregates at once.
Here is a quick example combining all these:</p>

<pre><code class="language-python">df.groupby('key').aggregate(['min', np.median, max])
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">data1</th>
      <th colspan="3" halign="left">data2</th>
    </tr>
    <tr>
      <th></th>
      <th>min</th>
      <th>median</th>
      <th>max</th>
      <th>min</th>
      <th>median</th>
      <th>max</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>0</td>
      <td>1.5</td>
      <td>3</td>
      <td>3</td>
      <td>4.0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>B</th>
      <td>1</td>
      <td>2.5</td>
      <td>4</td>
      <td>0</td>
      <td>3.5</td>
      <td>7</td>
    </tr>
    <tr>
      <th>C</th>
      <td>2</td>
      <td>3.5</td>
      <td>5</td>
      <td>3</td>
      <td>6.0</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>

<p>Another useful pattern is to pass a dictionary mapping column names to operations to be applied on that column:</p>

<pre><code class="language-python">df.groupby('key').aggregate({'data1': 'min',
                             'data2': 'max'})
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
      <th>data2</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>B</th>
      <td>1</td>
      <td>7</td>
    </tr>
    <tr>
      <th>C</th>
      <td>2</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>

<h4 id="filtering">Filtering</h4>

<p>A filtering operation allows you to drop data based on the group properties.
For example, we might want to keep all groups in which the standard deviation is larger than some critical value:</p>

<pre><code class="language-python">def filter_func(x):
    return x['data2'].std() &gt; 4

display('df', &quot;df.groupby('key').std()&quot;, &quot;df.groupby('key').filter(filter_func)&quot;)
</code></pre>

<div style="float: left; padding: 10px;">
    <p style='font-family:"Courier New", Courier, monospace'>df</p><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B</td>
      <td>4</td>
      <td>7</td>
    </tr>
    <tr>
      <th>5</th>
      <td>C</td>
      <td>5</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>
    </div>
<div style="float: left; padding: 10px;">
    <p style='font-family:"Courier New", Courier, monospace'>df.groupby('key').std()</p><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
      <th>data2</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>2.12132</td>
      <td>1.414214</td>
    </tr>
    <tr>
      <th>B</th>
      <td>2.12132</td>
      <td>4.949747</td>
    </tr>
    <tr>
      <th>C</th>
      <td>2.12132</td>
      <td>4.242641</td>
    </tr>
  </tbody>
</table>
</div>
    </div>
<div style="float: left; padding: 10px;">
    <p style='font-family:"Courier New", Courier, monospace'>df.groupby('key').filter(filter_func)</p><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B</td>
      <td>4</td>
      <td>7</td>
    </tr>
    <tr>
      <th>5</th>
      <td>C</td>
      <td>5</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>
    </div>

<p>The filter function should return a Boolean value specifying whether the group passes the filtering. Here because group A does not have a standard deviation greater than 4, it is dropped from the result.</p>

<h4 id="transformation">Transformation</h4>

<p>While aggregation must return a reduced version of the data, transformation can return some transformed version of the full data to recombine.
For such a transformation, the output is the same shape as the input.
A common example is to center the data by subtracting the group-wise mean:</p>

<pre><code class="language-python">df.groupby('key').transform(lambda x: x - x.mean())
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1.5</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.5</td>
      <td>-3.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.5</td>
      <td>-3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.5</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.5</td>
      <td>3.5</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.5</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>

<h4 id="the-apply-method">The apply() method</h4>

<p>The <code>apply()</code> method lets you apply an arbitrary function to the group results.
The function should take a <code>DataFrame</code>, and return either a Pandas object (e.g., <code>DataFrame</code>, <code>Series</code>) or a scalar; the combine operation will be tailored to the type of output returned.</p>

<p>For example, here is an <code>apply()</code> that normalizes the first column by the sum of the second:</p>

<pre><code class="language-python">def norm_by_data2(x):
    # x is a DataFrame of group values
    x['data1'] /= x['data2'].sum()
    return x

display('df', &quot;df.groupby('key').apply(norm_by_data2)&quot;)
</code></pre>

<div style="float: left; padding: 10px;">
    <p style='font-family:"Courier New", Courier, monospace'>df</p><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B</td>
      <td>4</td>
      <td>7</td>
    </tr>
    <tr>
      <th>5</th>
      <td>C</td>
      <td>5</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>
    </div>
<div style="float: left; padding: 10px;">
    <p style='font-family:"Courier New", Courier, monospace'>df.groupby('key').apply(norm_by_data2)</p><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>0.000000</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>0.142857</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>0.166667</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A</td>
      <td>0.375000</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B</td>
      <td>0.571429</td>
      <td>7</td>
    </tr>
    <tr>
      <th>5</th>
      <td>C</td>
      <td>0.416667</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>
    </div>

<p><code>apply()</code> within a <code>GroupBy</code> is quite flexible: the only criterion is that the function takes a <code>DataFrame</code> and returns a Pandas object or scalar; what you do in the middle is up to you!</p>

<h3 id="specifying-the-split-key">Specifying the split key</h3>

<p>In the simple examples presented before, we split the <code>DataFrame</code> on a single column name.
This is just one of many options by which the groups can be defined, and we&rsquo;ll go through some other options for group specification here.</p>

<h4 id="a-list-array-series-or-index-providing-the-grouping-keys">A list, array, series, or index providing the grouping keys</h4>

<p>The key can be any series or list with a length matching that of the <code>DataFrame</code>. For example:</p>

<pre><code class="language-python">L = [0, 1, 0, 1, 2, 0]
display('df', 'df.groupby(L).sum()')
</code></pre>

<div style="float: left; padding: 10px;">
    <p style='font-family:"Courier New", Courier, monospace'>df</p><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B</td>
      <td>4</td>
      <td>7</td>
    </tr>
    <tr>
      <th>5</th>
      <td>C</td>
      <td>5</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>
    </div>
<div style="float: left; padding: 10px;">
    <p style='font-family:"Courier New", Courier, monospace'>df.groupby(L).sum()</p><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7</td>
      <td>17</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div>
    </div>

<p>Of course, this means there&rsquo;s another, more verbose way of accomplishing the <code>df.groupby('key')</code> from before:</p>

<pre><code class="language-python">display('df', &quot;df.groupby(df['key']).sum()&quot;)
</code></pre>

<div style="float: left; padding: 10px;">
    <p style='font-family:"Courier New", Courier, monospace'>df</p><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>B</td>
      <td>4</td>
      <td>7</td>
    </tr>
    <tr>
      <th>5</th>
      <td>C</td>
      <td>5</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>
    </div>
<div style="float: left; padding: 10px;">
    <p style='font-family:"Courier New", Courier, monospace'>df.groupby(df['key']).sum()</p><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
      <th>data2</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>3</td>
      <td>8</td>
    </tr>
    <tr>
      <th>B</th>
      <td>5</td>
      <td>7</td>
    </tr>
    <tr>
      <th>C</th>
      <td>7</td>
      <td>12</td>
    </tr>
  </tbody>
</table>
</div>
    </div>

<h4 id="a-dictionary-or-series-mapping-index-to-group">A dictionary or series mapping index to group</h4>

<p>Another method is to provide a dictionary that maps index values to the group keys:</p>

<pre><code class="language-python">df2 = df.set_index('key')
mapping = {'A': 'vowel', 'B': 'consonant', 'C': 'consonant'}
display('df2', 'df2.groupby(mapping).sum()')
</code></pre>

<div style="float: left; padding: 10px;">
    <p style='font-family:"Courier New", Courier, monospace'>df2</p><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
      <th>data2</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>B</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>C</th>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>A</th>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>B</th>
      <td>4</td>
      <td>7</td>
    </tr>
    <tr>
      <th>C</th>
      <td>5</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>
    </div>
<div style="float: left; padding: 10px;">
    <p style='font-family:"Courier New", Courier, monospace'>df2.groupby(mapping).sum()</p><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>consonant</th>
      <td>12</td>
      <td>19</td>
    </tr>
    <tr>
      <th>vowel</th>
      <td>3</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div>
    </div>

<h4 id="any-python-function">Any Python function</h4>

<p>Similar to mapping, you can pass any Python function that will input the index value and output the group:</p>

<pre><code class="language-python">display('df2', 'df2.groupby(str.lower).mean()')
</code></pre>

<div style="float: left; padding: 10px;">
    <p style='font-family:"Courier New", Courier, monospace'>df2</p><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
      <th>data2</th>
    </tr>
    <tr>
      <th>key</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>B</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>C</th>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>A</th>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>B</th>
      <td>4</td>
      <td>7</td>
    </tr>
    <tr>
      <th>C</th>
      <td>5</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>
    </div>
<div style="float: left; padding: 10px;">
    <p style='font-family:"Courier New", Courier, monospace'>df2.groupby(str.lower).mean()</p><div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>1.5</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>b</th>
      <td>2.5</td>
      <td>3.5</td>
    </tr>
    <tr>
      <th>c</th>
      <td>3.5</td>
      <td>6.0</td>
    </tr>
  </tbody>
</table>
</div>
    </div>

<h4 id="a-list-of-valid-keys">A list of valid keys</h4>

<p>Further, any of the preceding key choices can be combined to group on a multi-index:</p>

<pre><code class="language-python">df2.groupby([str.lower, mapping]).mean()
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <th>vowel</th>
      <td>1.5</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>b</th>
      <th>consonant</th>
      <td>2.5</td>
      <td>3.5</td>
    </tr>
    <tr>
      <th>c</th>
      <th>consonant</th>
      <td>3.5</td>
      <td>6.0</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="grouping-example">Grouping example</h3>

<p>As an example of this, in a couple lines of Python code we can put all these together and count discovered planets by method and by decade:</p>

<pre><code class="language-python">decade = 10 * (planets['year'] // 10)
decade = decade.astype(str) + 's'
decade.name = 'decade'
planets.groupby(['method', decade])['number'].sum().unstack().fillna(0)
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>decade</th>
      <th>1980s</th>
      <th>1990s</th>
      <th>2000s</th>
      <th>2010s</th>
    </tr>
    <tr>
      <th>method</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Astrometry</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Eclipse Timing Variations</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>Imaging</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>29.0</td>
      <td>21.0</td>
    </tr>
    <tr>
      <th>Microlensing</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>12.0</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>Orbital Brightness Modulation</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Pulsar Timing</th>
      <td>0.0</td>
      <td>9.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Pulsation Timing Variations</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Radial Velocity</th>
      <td>1.0</td>
      <td>52.0</td>
      <td>475.0</td>
      <td>424.0</td>
    </tr>
    <tr>
      <th>Transit</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>64.0</td>
      <td>712.0</td>
    </tr>
    <tr>
      <th>Transit Timing Variations</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>9.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>This shows the power of combining many of the operations we&rsquo;ve discussed up to this point when looking at realistic datasets.
We immediately gain a coarse understanding of when and how planets have been discovered over the past several decades!</p>

<p>Here I would suggest digging into these few lines of code, and evaluating the individual steps to make sure you understand exactly what they are doing to the result.
It&rsquo;s certainly a somewhat complicated example, but understanding these pieces will give you the means to similarly explore your own data.</p>

          </div>

          



          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item box ">
    <div class="meta-nav meta-prev">Previous <br>
    <a href="/tutorials/data-science-handbook/3.pandas/03.07-merge-and-join/" rel="next">Merge and Join</a></div>
  </div>
  
  
  
  <div class="post-nav-item box">
    <div class="meta-nav meta-next" >Next <br>
    <a href="/tutorials/data-science-handbook/3.pandas/03.09-pivot-tables/" rel="prev">Pivot Tables</a></div>
  </div>
  
  <br>
  <br>
</div>

          </div>
          
        </div>

        <div class="body-footer">
          Last updated on Jun 19, 2020
        </div>

      </article>

      <footer class="site-footer">

  <div class="container">
    <div class="row">
      <div class="col-md-6">
        
        <p>
          
          Powered by
          <a href="https://themefisher.com" target="_blank" rel="noopener">themefisher</a> for
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.
        </p>
      </div>
      <div class="col-md-6">
        <ul class="list-inline network-icon text-right">
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://twitter.com/Twitter" target="_blank" rel="noopener" title="DM Me"><i class="fab fa-twitter" aria-hidden="true"></i></a>
          </li>
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="skype:echo123?call"  title="Skype Me"><i class="fab fa-skype" aria-hidden="true"></i></a>
          </li>
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://keybase.io/" target="_blank" rel="noopener" title="Chat on Keybase"><i class="fab fa-keybase" aria-hidden="true"></i></a>
          </li>
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://discourse.gohugo.io" target="_blank" rel="noopener" title="Discuss on Forum"><i class="fas fa-comments" aria-hidden="true"></i></a>
          </li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>

    </main>
  </div>
</div>


      

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/python.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academia.min.e4fc229c2f28284fc2dfa5b66a52b765.js"></script>

    






  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
