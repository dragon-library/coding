<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academia 4.3.1">
  <meta name="generator" content="Hugo 0.59.1" />

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Little Dragon">

  
  
  
    
  
  <meta name="description" content="บทความนี้ก็จะสอนวิธีหนึ่งที่สามารถทำได้ เพื่อหา XPath ที่  **&#34;น่าจะ&#34;**  ครอบคลุมข้อมูลทั้งหมดที่เราต้องการมานะครับ ซึ่งเป็นวิธีที่ผู้เขียนเองก็ใช้งานอยู่จริงในการ scrape website ในหลาย ๆ ครั้ง">

  
  <link rel="alternate" hreflang="en-us" href="https://dragon-library.github.io/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-3/">

  


  

  
  
  
  <meta name="theme-color" content="#c7254e">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kanit:400,700|Sarabun|Roboto&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/docs/css/academia.min.ff05a21b53038f9dccb7f30aedbfb6d7.css">

  

  
  
  

  

  <link rel="manifest" href="/docs/site.webmanifest">
  <link rel="icon" type="image/png" href="/docs/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/docs/img/icon-192.png">

  <link rel="canonical" href="https://dragon-library.github.io/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-3/">

  
  
  
  
    
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Library">
  <meta property="og:url" content="https://dragon-library.github.io/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-3/">
  <meta property="og:title" content="Python Web Scraping Part III - เทคนิคการ extract ข้อมูลด้วย XPath | Library">
  <meta property="og:description" content="บทความนี้ก็จะสอนวิธีหนึ่งที่สามารถทำได้ เพื่อหา XPath ที่  **&#34;น่าจะ&#34;**  ครอบคลุมข้อมูลทั้งหมดที่เราต้องการมานะครับ ซึ่งเป็นวิธีที่ผู้เขียนเองก็ใช้งานอยู่จริงในการ scrape website ในหลาย ๆ ครั้ง"><meta property="og:image" content="https://dragon-library.github.io/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-3/featured.png">
  <meta property="twitter:image" content="https://dragon-library.github.io/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-3/featured.png"><meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2020-04-12T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2020-06-18T02:48:28&#43;07:00">
  

  


  





  <title>Python Web Scraping Part III - เทคนิคการ extract ข้อมูลด้วย XPath | Library</title>

</head>


<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/docs/">Library</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation"><span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/docs/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/docs/python/"><span>Python</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/docs/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/docs/tutorials/"><span>Tutorials</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/docs/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/docs/book/"><span>Book</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/docs/courses/"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/docs/#contact"><span>Contact</span></a>
        </li>

        
        

      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article py-5" itemscope itemtype="http://schema.org/Article">

  












    

    
    
    
    <div class="article-container py-3">
      <h1 itemprop="name">Python Web Scraping Part III - เทคนิคการ extract ข้อมูลด้วย XPath</h1>

      
      <p class="page-subtitle">บทความนี้ก็จะสอนวิธีหนึ่งที่สามารถทำได้ เพื่อหา XPath ที่  <strong>&laquo;น่าจะ&raquo;</strong>  ครอบคลุมข้อมูลทั้งหมดที่เราต้องการมานะครับ ซึ่งเป็นวิธีที่ผู้เขียนเองก็ใช้งานอยู่จริงในการ scrape website ในหลาย ๆ ครั้ง</p>
      

      
      



<meta content="2020-04-12 00:00:00 &#43;0000 UTC" itemprop="datePublished">
<meta content="2020-06-18 02:48:28 &#43;0700 &#43;07" itemprop="dateModified">

<div class="article-metadata">

  
  
  
  
  <div>
    



  <span itemprop="author name" itemtype="http://schema.org/Person"><a href="/docs/authors/admin/">Little Dragon</a></span>

  </div>
  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    <time>Jun 18, 2020</time>
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    4 min read
  </span>
  

  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    <a href="/docs/categories/example/">Example</a>, <a href="/docs/categories/python/">Python</a>, <a href="/docs/categories/series/">Series</a></span>
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://dragon-library.github.io/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-3/&amp;text=Python%20Web%20Scraping%20Part%20III%20-%20%e0%b9%80%e0%b8%97%e0%b8%84%e0%b8%99%e0%b8%b4%e0%b8%84%e0%b8%81%e0%b8%b2%e0%b8%a3%20extract%20%e0%b8%82%e0%b9%89%e0%b8%ad%e0%b8%a1%e0%b8%b9%e0%b8%a5%e0%b8%94%e0%b9%89%e0%b8%a7%e0%b8%a2%20XPath" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://dragon-library.github.io/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-3/&amp;t=Python%20Web%20Scraping%20Part%20III%20-%20%e0%b9%80%e0%b8%97%e0%b8%84%e0%b8%99%e0%b8%b4%e0%b8%84%e0%b8%81%e0%b8%b2%e0%b8%a3%20extract%20%e0%b8%82%e0%b9%89%e0%b8%ad%e0%b8%a1%e0%b8%b9%e0%b8%a5%e0%b8%94%e0%b9%89%e0%b8%a7%e0%b8%a2%20XPath" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Python%20Web%20Scraping%20Part%20III%20-%20%e0%b9%80%e0%b8%97%e0%b8%84%e0%b8%99%e0%b8%b4%e0%b8%84%e0%b8%81%e0%b8%b2%e0%b8%a3%20extract%20%e0%b8%82%e0%b9%89%e0%b8%ad%e0%b8%a1%e0%b8%b9%e0%b8%a5%e0%b8%94%e0%b9%89%e0%b8%a7%e0%b8%a2%20XPath&amp;body=https://dragon-library.github.io/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-3/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://dragon-library.github.io/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-3/&amp;title=Python%20Web%20Scraping%20Part%20III%20-%20%e0%b9%80%e0%b8%97%e0%b8%84%e0%b8%99%e0%b8%b4%e0%b8%84%e0%b8%81%e0%b8%b2%e0%b8%a3%20extract%20%e0%b8%82%e0%b9%89%e0%b8%ad%e0%b8%a1%e0%b8%b9%e0%b8%a5%e0%b8%94%e0%b9%89%e0%b8%a7%e0%b8%a2%20XPath" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Python%20Web%20Scraping%20Part%20III%20-%20%e0%b9%80%e0%b8%97%e0%b8%84%e0%b8%99%e0%b8%b4%e0%b8%84%e0%b8%81%e0%b8%b2%e0%b8%a3%20extract%20%e0%b8%82%e0%b9%89%e0%b8%ad%e0%b8%a1%e0%b8%b9%e0%b8%a5%e0%b8%94%e0%b9%89%e0%b8%a7%e0%b8%a2%20XPath%20https://dragon-library.github.io/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-3/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://dragon-library.github.io/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-3/&amp;title=Python%20Web%20Scraping%20Part%20III%20-%20%e0%b9%80%e0%b8%97%e0%b8%84%e0%b8%99%e0%b8%b4%e0%b8%84%e0%b8%81%e0%b8%b2%e0%b8%a3%20extract%20%e0%b8%82%e0%b9%89%e0%b8%ad%e0%b8%a1%e0%b8%b9%e0%b8%a5%e0%b8%94%e0%b9%89%e0%b8%a7%e0%b8%a2%20XPath" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>


  

</div>

      














      
      
    </div>
  </div>
</div>

  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      

<p><img src="featured.png" alt="" /></p>

<p>หลังจากที่ใน  <a href="https://dev.to/copypasteengineer/python-web-scraping-part-2-chrome-s-code-inspector-3ok6" target="_blank">part ที่แล้ว</a>  เราได้เรียนรู้วิธีการแกะ XPath ของแต่ละ element ออกมาจาก web browser แบบง่าย ๆ กันแล้ว แต่ทีนี้ในกรณีที่ข้อมูลที่เราสนใจมีหลายตำแหน่งมาก  <strong>เราคงไม่อยากเสียเวลานั่ง extract แต่ละ element ด้วยมือทั้งหมดใช่ไหมครับ</strong>  (เพราะถ้าจะทำด้วยมือทั้งหมด ก็ก๊อปตัวข้อมูลมาตรง ๆ เลยสะดีกว่า 555)</p>

<p>ท่านที่พอจะมีประสบการณ์การทำเว็บมาบ้าง พอเห็น XPath สัก 1 หรือ 2 อัน ก็อาจจะเดาได้แล้ว ว่า XPath ที่เหมาะสม ที่น่าจะครอบคลุมทุก ๆ element นั้น ควรจะเป็นอะไร แต่ถึงจะเดาไม่ออกก็ไม่เป็นไรครับ เพราะอย่างบาง website ที่ซับซ้อนขึ้นหน่อย ต่อให้มีประสบการณ์ก็คงเดาไม่ออกในทีแรกเช่นกัน</p>

<p>สำหรับในบทความนี้ก็จะสอนวิธีหนึ่งที่สามารถทำได้ เพื่อหา XPath ที่  <strong>&laquo;น่าจะ&raquo;</strong>  ครอบคลุมข้อมูลทั้งหมดที่เราต้องการมานะครับ ซึ่งเป็นวิธีที่ผู้เขียนเองก็ใช้งานอยู่จริงในการ scrape website ในหลาย ๆ ครั้งครับ (ที่บอกว่า  <strong>&laquo;น่าจะ&raquo;</strong>  เนี่ย เพราะว่าในความเป็นจริงไม่มีใครรู้หรอกครับ ว่า website เป้าหมายนี้ ถูกเขียน หรือถูกสร้างมาอย่างไร แต่ด้วยวิธีดังกล่าว+หลักของสถิติ เราก็จะมั่นใจได้ในระดับหนึ่งว่า XPath ของเรามัน  <strong>&laquo;น่าจะ&raquo;</strong>  ดีเพียงพอครับ)</p>

<p>วิธีหนึ่งที่ผมทำก็คือ sample XPath ออกมาดู เอามา  <strong>สำรวจ</strong>  เพิ่มอีกเยอะ ๆ ก็จะช่วยให้เห็นภาพมากขึ้นครับ จากนั้นเราก็จะใช้ syntax ของ XPath ในการ select และระบุ condition เพื่อให้ครอบคลุมกรณีที่เรา sample ออกมา ให้มากที่สุดครับ</p>

<h2 id="get-started">Get Started!</h2>

<p>ทบทวนสักเล็กน้อย ใน part นี้เราก็ยังอยู่กับเว็บ Wikipedia  <a href="https://th.wikipedia.org/wiki/%E0%B8%A3%E0%B8%B2%E0%B8%A2%E0%B8%8A%E0%B8%B7%E0%B9%88%E0%B8%AD%E0%B9%80%E0%B8%97%E0%B8%A8%E0%B8%9A%E0%B8%B2%E0%B8%A5%E0%B8%95%E0%B8%B3%E0%B8%9A%E0%B8%A5%E0%B9%83%E0%B8%99%E0%B8%9B%E0%B8%A3%E0%B8%B0%E0%B9%80%E0%B8%97%E0%B8%A8%E0%B9%84%E0%B8%97%E0%B8%A2" target="_blank">https://th.wikipedia.org/wiki/รายชื่อเทศบาลตำบลในประเทศไทย</a>  กันเหมือนเดิมนะครับ โดยเป้าหมายคือ  <strong>หา XPath สำหรับ extract รายชื่อเทศบาลตำบลทั้งหมด</strong>  ซึ่งใน  <a href="https://dev.to/copypasteengineer/python-web-scraping-part-2-chrome-s-code-inspector-3ok6" target="_blank">part ที่แล้ว</a>  เราใช้ Chrome Inspector ในการแกะ XPath ของ  <strong>&laquo;Element&raquo; หนึ่ง ๆ</strong>  มาได้แบบง่าย ๆ แล้วนะครับ ในตอนนี้เรากำลังจะหา XPath ที่สามารถ extract ข้อมูลทั้งหมดได้  <strong>(คือครอบคลุมทุก element ไม่ใช่แค่ 1 element)</strong></p>

<h3 id="1-sample-xpath-มาเพ-ม">1. Sample XPath มาเพิ่ม</h3>

<p>อย่างในเว็บเป้าหมาย ถ้าลอง scroll เลื่อนขึ้นลงดู จะเห็นว่ามันมีหลายตาราง เพราะฉะนั้น เพื่อให้เราได้เห็นรูปแบบที่หลากหลาย แล้วก็ครอบคลุมข้อมูลทั้งหมดมากที่สุด ก็ควรจะหยิบ sample ออกมาจากหลาย ๆ ที่ กระจาย ๆ กันหน่อยนั่นเองครับ เช่น เอามาจากตาราง 1 บ้าง จากตาราง 8 บ้าง จากตารางสุดท้ายบ้าง หรือจากหัวตารางบ้าง จากท้ายตารางบ้าง ปน ๆ กันไป  <strong>โดยหลักสถิติแล้วยิ่งเราสุ่มมามากเท่าไหร่ เราก็จะยิ่งมั่นใจได้ว่าเราได้เห็น pattern ที่เป็นไปได้ทั้งหมดแล้วมากขึ้นนั่นเองครับ</strong>  (จะเรียกว่าหลักสถิติหรือดวงก็ได้นะครับ 555)</p>

<p>สำหรับท่านที่ยังไม่เข้าใจว่าจะเอา sample XPath ตรงนี้มาได้อย่างไร  <strong>กรุณาอ่าน  <a href="https://dev.to/copypasteengineer/python-web-scraping-part-2-chrome-s-code-inspector-3ok6" target="_blank">part 2</a>  ด่วน ๆ เลยครับ!</strong>  หรือถ้ามีข้อสงสัย สามารถคอมเม้นถามด้านล่าง หรือในเพจ  <a href="https://www.facebook.com/CopyPasteEng/" target="_blank">Copy Paste Engineer</a>  ได้เลยนะครับ</p>

<p>ด้านล่างนี้เป็นตัวอย่างที่ผม sample ออกมา</p>

<pre><code> (1) //*[@id=&quot;mw-content-text&quot;]/div/table[3]/tbody/tr[1]/td[3]/b/a    (ตาราง 1 บรรทัด 1)
 (2) //*[@id=&quot;mw-content-text&quot;]/div/table[3]/tbody/tr[2]/td[3]/b/a    (ตาราง 1 บรรทัด 2)
 (3) //*[@id=&quot;mw-content-text&quot;]/div/table[3]/tbody/tr[10]/td[3]/b/a   (ตาราง 1 บรรทัด 10)
 (4) //*[@id=&quot;mw-content-text&quot;]/div/table[4]/tbody/tr[3]/td[3]/b/a    (ตาราง 2 บรรทัด 1)
 (5) //*[@id=&quot;mw-content-text&quot;]/div/table[4]/tbody/tr[30]/td[2]/b/a   (ตาราง 2 บรรทัด 28)
 (6) //*[@id=&quot;mw-content-text&quot;]/div/table[7]/tbody/tr[25]/td[2]/b/a/b (ตาราง 5 บรรทัด 23)
 (7) //*[@id=&quot;mw-content-text&quot;]/div/table[10]/tbody/tr[41]/td[2]/b/a  (ตาราง 8 บรรทัดสุดท้าย)
 (8) //*[@id=&quot;mw-content-text&quot;]/div/table[24]/tbody/tr[3]/td[3]/a/b   (ตาราง 22 บรรทัด 1)
 (9) //*[@id=&quot;mw-content-text&quot;]/div/table[76]/tbody/tr[3]/td[3]/b/a   (ตารางสุดท้าย บรรทัด 1)
(10) //*[@id=&quot;mw-content-text&quot;]/div/table[76]/tbody/tr[37]/td[2]/b/a  (ตารางสุดท้าย บรรทัดสุดท้าย)

</code></pre>

<p>จะเห็นว่า XPath จริง ๆ ของข้อมูลเรา มันไม่ได้ตรงไปตรงมาเสมอไปนะครับ อย่างเช่นตัวเลขของ table และ tr ใน XPath ของแต่ละ sample นั้น ก็อาจจะไม่ได้สัมพันธ์กับเลขตารางหรือเลขบรรทัดของข้อมูลเสมอไป หรือบางทีก็มี element b บ้าง บางทีก็ไม่มี  <strong>ซึ่งในเหตุการณ์เช่นนี้สามารถพบเจอได้จริง ในเว็บทั่ว ๆ ไปนะครับ</strong>  โดยอาจเกิดจาก developer ที่เขียนโค้ดไม่สัมพันธ์กันเอง หรืออย่างในกรณีของ Wikipedia นี้ คืออาจเกิดจาก user ซึ่งเป็นผู้เขียนบทความได้ใช้โครงสร้างของข้อมูลที่แตกต่างกันนั่นเองครับ</p>

<h3 id="2-สำรวจ-xpath">2. สำรวจ XPath</h3>

<p>ในขั้นตอนนี้ เราจะทำการวิเคราะห์ XPath ที่เรา sample ออกมา แล้วก็ตั้งข้อสังเกตุถึง  <strong>จุดที่เหมือน</strong>  และ  <strong>จุดที่แตกต่าง</strong>  สำหรับแต่ละตัวอย่างนะครับ ซึ่งอาจจะต้องใช้ความรู้ HTML เล็กน้อยนะครับ แต่จะพยายามอธิบายให้เข้าใจง่ายที่สุดนะครับ</p>

<p>เมื่อเรา sample ออกมาดูเยอะ ๆ แล้วก็จะเห็นครับว่ามันมีส่วนที่เหมือนกันอยู่ คือ ขึ้นต้นด้วย element  <code>&lt;table&gt;</code></p>

<pre><code>//*[@id=&quot;mw-content-text&quot;]/div/table

</code></pre>

<p>ซึ่ง  <code>&lt;table&gt;</code>  ก็หมายถึงตัวตารางแต่ละตารางนั่นเองครับ</p>

<p>และจะสังเกตุได้จาก XPath ที่ได้มา ว่าข้อมูลที่เราต้องการ<br />
<strong>1.</strong>  จะเริ่มต้นที่  <strong>ตารางที่ 3</strong>  (เพราะในตารางที่ 1 บรรทัดที่ 1 ใช้  <code>table[3]</code>)<br />
<strong>2.</strong>  แล้วตามด้วย  <code>&lt;tbody&gt;</code><br />
<strong>3.</strong>  ตามด้วย  <code>&lt;tr&gt;</code>  คือแต่ละ row ของ table นั้น ๆ<br />
<strong>4.</strong>  จากนั้นก็  <code>&lt;td&gt;</code>  คือแต่ละ column ของ row นั้น ๆ ซึ่งอาจจะเป็น  <strong>column ที่ 2 หรือ column ที่ 3 ก็ได้</strong>  (เช่น sample  <code>(4)</code>  และ  <code>(5)</code>)</p>

<pre><code>(4) //*[@id=&quot;mw-content-text&quot;]/div/table[4]/tbody/tr[3]/td[3]/b/a    (ตาราง 2 บรรทัด 1)
(5) //*[@id=&quot;mw-content-text&quot;]/div/table[4]/tbody/tr[30]/td[2]/b/a   (ตาราง 2 บรรทัด 28)

</code></pre>

<p><strong>5.</strong>  แล้วก็อาจจะมี หรือไม่มี  <code>&lt;b&gt;</code>  ก็ได้ (กรณีที่ไม่มี  <code>&lt;b&gt;</code>  ดู sample ที่  <code>(8)</code>)</p>

<pre><code>(8) //*[@id=&quot;mw-content-text&quot;]/div/table[24]/tbody/tr[3]/td[3]/a/b   (ตาราง 22 บรรทัด 1)

</code></pre>

<p><strong>6.</strong>  ตามด้วย  <code>&lt;a&gt;</code>  คือข้อความที่เป็น link<br />
<strong>7.</strong>  แล้วก็อาจจะมี หรือไม่มี  <code>&lt;b&gt;</code>  ก็ได้</p>

<p>นี่ก็เป็นข้อสังเกตุทั้งหมดที่เราได้จาก sample ของเรานะครับ</p>

<h3 id="3-สร-าง-xpath-จร-ง-ๆ-ส-กท-555">3. สร้าง XPath (จริง ๆ สักที 555)**</h3>

<p>ต่อไป จากข้อสังเกตุทั้ง 7 ข้อ ด้านบน เราก็ได้ทราบแล้วว่า elements ที่เราต้องการ จะมี XPath ลักษณะอย่างไร  <strong>ทีนี้เรานำข้อสังเกตุทั้งหมดมารวมกัน เพื่อสร้าง XPath ขึ้นมา 1 อัน ที่สามารถครอบคลุม cases ที่กล่าวมาได้ทั้งหมด!</strong>  โดยใช้การเขียน  <strong>condition</strong>  มาเพื่อช่วยเลือก elements ที่ต้องการนะครับ อันดับแรกก็เริ่มจาก XPath ที่ทุก sample มีร่วมกันก่อน ก็คือ</p>

<pre><code>//*[@id=&quot;mw-content-text&quot;]/div/table

</code></pre>

<p>ทีนี้ ก็จะเริ่มใส่ condition ตามข้อสังเกตุของเราข้างต้นแล้วนะครับ<br />
<strong>1.</strong>  เราต้องการเลือกตารางตั้งแต่ตารางที่ 3 ขึ้นไปเท่านั้น วิธีการคือให้ใส่ condition เข้าไป ว่า  <strong>position ของ  <code>&lt;table&gt;</code>  เนี่ย ต้องมากกว่าหรือเท่ากับ 3 ครับ</strong>  ซึ่งเขียนเป็น condition ได้ว่า  <code>position() &gt;= 3</code>  ก็จะได้ XPath เป็น</p>

<pre><code>//*[@id=&quot;mw-content-text&quot;]/div/table[position() &gt;= 3]

</code></pre>

<p><strong>2.</strong>  ตามด้วย  <code>&lt;tbody&gt;</code>  และ  <code>&lt;tr&gt;</code>  ก็เติมเข้าไปตรง ๆ ได้เลยครับ</p>

<pre><code>//*[@id=&quot;mw-content-text&quot;]/div/table[position() &gt;= 3]/tbody/tr

</code></pre>

<p><strong>3.</strong>  ตามด้วย  <code>&lt;td&gt;</code>  แต่เราจะเอาเฉพาะ column ที่ 2 หรือ 3 เท่านั้น วิธีหนึ่งที่ทำได้ก็คือ ใส่ condition ว่า  <strong>position ของ  <code>&lt;td&gt;</code>  เนี่ย ต้อง &gt;= 2 และ &lt;= 3</strong>  ซึ่งเขียน condition ออกมาได้ว่า  <code>2 &lt;= position() and position() &lt;= 3</code>  จึงได้ XPath เป็น</p>

<pre><code>//*[@id=&quot;mw-c.../tbody/tr/td[2 &lt;= position() and position() &lt;= 3]

</code></pre>

<p><strong>4.</strong>  อย่างที่สังเกตุว่าบาง sample ก็มี  <code>&lt;b&gt;</code>  ขึ้นก่อนแล้วตามด้วย  <code>&lt;a&gt;</code>  (<code>/b/a/</code>)<br />
หรือบาง sample ก็เป็น  <code>&lt;a&gt;</code>  ขึ้นก่อน แล้วตามด้วย  <code>&lt;b&gt;</code>  (<code>/a/b/</code>)<br />
แล้วยังมี  <code>&lt;b&gt;</code>  แล้ว  <code>&lt;a&gt;</code>  แล้ว  <code>&lt;b&gt;</code>  อีก (<code>/b/a/b/</code>)<br />
โชคดีที่ใน XPath เราสามารถละได้ โดยการเขียนเป็น  <code>//a//</code>  จะหมายถึงว่าจะมี element อะไรขึ้นก่อน  <code>&lt;a&gt;</code>  ก็ได้ (กี่ elements ก็ได้ หรือจะไม่มีก็ได้) แล้วตามด้วย elements อะไรก็ได้ (กี่ elements ก็ได้ หรือจะไม่มีก็ได้) แล้วตัว engine ก็จะหาทุก ๆ elements ที่เป็นไปได้มาให้เองครับ</p>

<pre><code>//*[@id=&quot;mw-c.../tbody/tr/td[2 &lt;= position() and position() &lt;= 3]//a//

</code></pre>

<p><strong>note: ซึ่งการละใน XPath นี้ ต้องระวังในการใช้สักเล็กน้อยนะครับ อย่าง  <code>//a//</code>  อาจหมายถึง  <code>/b/a</code>  ก็ได้ หรือ  <code>/b/a/b</code>  ก็ได้ หรืออาจหมายถึง  <code>/b/div/a/div/b/a/b/div</code>  ก็ได้ คือในส่วนที่ละ จะแทนเป็นอะไรก็ได้นั่นเองครับ</strong></p>

<p><strong>5.</strong>  สุดท้ายตามด้วย  <code>text()</code>  คือต้องการเอาเฉพาะข้อความที่อยู่ใน element นั้นออกมา</p>

<pre><code>//*[@id=&quot;mw-c.../tbody/tr/td[2 &lt;= position() and position() &lt;= 3]//a//text()

</code></pre>

<p>ได้ XPath สุดท้ายเป็น</p>

<pre><code>//*[@id=&quot;mw-content-text&quot;]/div/table[position() &gt;= 3]/tbody/tr/td[2 &lt;= position() and position() &lt;= 3]//a//text()

</code></pre>

<p>ซึ่งเป็น XPath ที่เรามั่นใจว่าและครอบคลุมทุกกรณีที่เรา sample ออกมา และ(หวังว่า)จะครอบคลุมข้อมูลที่เราต้องการจริง ๆ ทั้งหมด</p>

<p><strong>และเป็น XPath ที่เราก็ได้นำไปใช้จริงแล้วในการ extract  <em>รายชื่อเทศบาลตำบล</em>  ใน  <a href="https://dev.to/copypasteengineer/python-web-scraping-part-1-python-49ce" target="_blank">บทความ part ที่ 1</a>  นั่นเองครับ</strong></p>

<h2 id="summary">Summary</h2>

<p>สำหรับการสร้าง XPath นั้น วิธีการที่นำเสนอไปก็เป็นหนึ่งในวิธีที่สามารถทำได้ง่าย ๆ ซึ่งเราจะสามารถมั่นใจได้ในระดับหนึ่งว่า XPath ที่ได้มานั้น  <strong>ครอบคลุมข้อมูลส่วนใหญ่ โดยทำการ sample ออกมาให้มากขึ้น และ sample  <em>ในหลาย ๆ จุดที่แตกต่างกัน กระจาย ๆ กันไป</em></strong>  แต่อาจจะต้องอาศัยความรู้ในเรื่อง syntax และคำสั่งของ XPath สักเล็กน้อยสำหรับการเขียน condition เพื่อ select element ต่าง ๆ นะครับ</p>

<p>ซึ่งจริง ๆ แล้ว  <strong>ผู้เขียนเองก็ไม่ได้จำคำสั่งของ XPath ได้ทั้งหมดจริง ๆ หรอกครับ</strong>  เมื่อจำเป็นต้องใช้ที ก็ search หาจาก internet เอา โดยผู้เขียนพบว่า  <strong>เว็บ  <em>w3school</em>  ได้ทำรายการของคำสั่งต่าง ๆ พร้อมคำอธิบายเอาไว้ได้ดีและครบถ้วนแล้ว ทุก ๆ ท่านสามารถนำไปใช้เพื่ออ้างอิงขณะที่เขียนได้เลยครับ  <a href="https://www.w3schools.com/xml/xpath_intro.asp" target="_blank">link นี้เลยครับ</a></strong></p>

<p>และถ้ามีเรื่องไหนที่สนใจเพิ่มเติมสามารถ comment เอาไว้ได้นะครับ</p>

<p>FB Page:  <a href="https://www.facebook.com/CopyPasteEng" target="_blank">Copy Paste Engineer</a></p>

<p><strong>Part อื่น ๆ ใน series</strong></p>

<ul>
<li><a href="../python-web-scraping-part-1/"> Part I - การดูดข้อมูลเบื้องต้น ด้วย Python</a></li>
<li><a href="../python-web-scraping-part-2/">Part II - Chrome&rsquo;s Code Inspector</a></li>
<li><a href="../python-web-scraping-part-4/">Part IV - ทำไมถึง scrape บางเว็บไม่ได้</a></li>
</ul>

<blockquote>
<p>Reference : <a href="https://dev.to/copypasteengineer/python-web-scraping-part-3-extract-xpath-18h" target="_blank">https://dev.to/copypasteengineer/</a></p>
</blockquote>

    </div>

    

<div class="article-tags">
  
  <a class="badge badge-light" href="/docs/tags/web-scraping/">Web Scraping</a>
  
</div>



    
      








  
  
    
  
  





  
  
  
    
  
  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="https://dragon-library.github.io/docs/">Little Dragon</a></h5>
      <h6 class="card-subtitle">Professor of Artificial Intelligence</h6>
      <p class="card-text" itemprop="description">My research interests include distributed robotics, mobile computing and programmable matter.</p>
      <ul class="network-icon" aria-hidden="true">
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="/docs/#contact" >
              <i class="fas fa-envelope"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://twitter.com/GeorgeCushen" target="_blank" rel="noopener">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://scholar.google.co.uk/citations?user=sIwtMXoAAAAJ" target="_blank" rel="noopener">
              <i class="ai ai-google-scholar"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://github.com/gcushen" target="_blank" rel="noopener">
              <i class="fab fa-github"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>



      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-2/">Python Web Scraping Part II - Chrome&#39;s Code Inspector</a></li>
          
          <li><a href="/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-1/">Python Web Scraping Part I</a></li>
          
        </ul>
      </div>
      
    

    
    <div class="article-widget">
      
<div class="post-nav">
  
  
  
  <div class="post-nav-item box ">
    <div class="meta-nav meta-prev">Next <br>
    <a href="/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-4/" rel="next">Python Web Scraping Part IV - ทำไมถึง scrape บางเว็บไม่ได้</a></div>
  </div>
  
  
  
  <div class="post-nav-item box">
    <div class="meta-nav meta-next" >Previous <br>
    <a href="/docs/post/python/example/web-scraping-series-1/python-web-scraping-part-2/" rel="prev">Python Web Scraping Part II - Chrome&#39;s Code Inspector</a></div>
  </div>
  
  <br>
  <br>
</div>

    </div>
    

    


  </div>
</article>

      

    
    
    
    <script src="/docs/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/python.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/docs/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/docs/js/academia.min.e4fc229c2f28284fc2dfa5b66a52b765.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">

  <div class="container">
    <div class="row">
      <div class="col-md-6">
        
        <p>
          
          Powered by
          <a href="https://themefisher.com" target="_blank" rel="noopener">themefisher</a> for
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.
        </p>
      </div>
      <div class="col-md-6">
        <ul class="list-inline network-icon text-right">
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://twitter.com/Twitter" target="_blank" rel="noopener" title="DM Me"><i class="fab fa-twitter" aria-hidden="true"></i></a>
          </li>
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="skype:echo123?call"  title="Skype Me"><i class="fab fa-skype" aria-hidden="true"></i></a>
          </li>
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://keybase.io/" target="_blank" rel="noopener" title="Chat on Keybase"><i class="fab fa-keybase" aria-hidden="true"></i></a>
          </li>
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://discourse.gohugo.io" target="_blank" rel="noopener" title="Discuss on Forum"><i class="fas fa-comments" aria-hidden="true"></i></a>
          </li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>
  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
